<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Histórico de Pedidos - Loja Oficial do Flamengo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .orders-container { max-width: 1100px; margin: 40px auto; padding: 20px; }
        .orders-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; }
        .orders-list { display:grid; gap:12px; }
        .order-card { background:#111; border:1px solid #333; padding:16px; border-left:4px solid #e30613; border-radius:6px; color:#ddd; }
        .order-row { display:flex; justify-content:space-between; align-items:center; gap:12px; }
        .order-meta { color:#fff; font-weight:600; }
        .order-total { color:#e30613; font-weight:700; }
        .order-details { margin-top:10px; display:none; border-top:1px dashed #333; padding-top:10px; }
        .order-items { margin-bottom:8px; }
        .btn-small { background:#e30613; color:#fff; border:none; padding:8px 10px; border-radius:4px; cursor:pointer; }
        .empty { text-align:center; color:#bbb; padding:40px; }
        @media (max-width:768px){ .order-row { flex-direction:column; align-items:flex-start; } }
    </style>
</head>
<body>
    <header class="meli-header">
        <div class="header-top-bar">
            <div class="logo-container">
                <a href="index.html"><img src="imagens/logo1.jpg" alt="Flamengo Logo" class="meli-logo"></a>
            </div>
            <div class="header-right-items" style="flex-grow:1; justify-content:flex-end;">
                <span style="color:#fff; margin-right:20px;">Pedidos</span>
            </div>
        </div>
        <nav class="header-bottom-nav">
            <div class="categories-container"><i class="fas fa-bars"></i><span>Camisas</span></div>
            <div class="main-nav">
                <a href="camisas-oficiais.html" class="nav-link">Camisas Oficiais</a>
                <a href="acessorios.html" class="nav-link">Acessórios</a>
                <a href="infantil.html" class="nav-link">Infantil</a>
                <a href="promocoes.html" class="nav-link">Promoções</a>
            </div>
            <div class="account-nav">
                <a href="account.html" class="nav-link">Minha conta</a>
                <a href="orders.html" class="nav-link">Pedidos</a>
                <a href="#" class="nav-link">Ajuda</a>
            </div>
        </nav>
    </header>

    <main class="orders-container">
        <div class="orders-header">
            <h1 style="color:#e30613;">Histórico de Pedidos</h1>
            <a href="index.html" class="btn-small">Voltar à loja</a>
        </div>

        <div id="ordersList" class="orders-list"></div>
    </main>

    <footer class="site-footer">
        <div class="footer-bottom">
            <p>© <span id="year"></span> Clube de Regatas do Flamengo — Loja Oficial. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function(){
            const yearEl = document.getElementById('year'); if (yearEl) yearEl.textContent = new Date().getFullYear();
            const ordersKey = 'flamengoOrders';
            const ordersListEl = document.getElementById('ordersList');
            const orders = JSON.parse(localStorage.getItem(ordersKey) || '[]');

            if (!orders || orders.length === 0) {
                ordersListEl.innerHTML = '<div class="empty">Você ainda não tem pedidos registrados.</div>';
                return;
            }

            // Ordenar por data decrescente
            orders.sort((a,b) => new Date(b.date) - new Date(a.date));

            orders.forEach(order => {
                const date = new Date(order.date);
                const dateStr = date.toLocaleString('pt-BR');

                const card = document.createElement('div');
                card.className = 'order-card';

                card.innerHTML = `
                    <div class="order-row">
                        <div>
                            <div class="order-meta">Pedido <span style="color:#fff;">${order.id}</span></div>
                            <div style="font-size:0.9rem; color:#bbb">${dateStr}</div>
                        </div>
                        <div style="text-align:right">
                            <div class="order-total">R$ ${order.total.toFixed(2).replace('.', ',')}</div>
                            <div style="font-size:0.85rem; color:#bbb">${order.status}</div>
                            <div style="margin-top:8px"><button class="btn-small" data-id="${order.id}">Ver detalhes</button></div>
                        </div>
                    </div>
                    <div class="order-details" id="details-${order.id}">
                        <div class="order-items">
                            <strong>Itens:</strong>
                            <ul>
                                ${order.items.map(item => `<li>${item.name} — ${item.quantity}x — R$ ${ (item.price * item.quantity).toFixed(2).replace('.', ',')}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="order-customer">
                            <strong>Cliente:</strong>
                            <div>${order.customer.name} — ${order.customer.email}</div>
                            <div>${order.customer.address}, ${order.customer.number} ${order.customer.complement ? '- ' + order.customer.complement : ''}</div>
                            <div>${order.customer.city} / ${order.customer.state} — CEP: ${order.customer.cep}</div>
                        </div>
                        <div style="margin-top:10px">
                            <button class="btn-small" onclick="window.print()">Imprimir</button>
                        </div>
                    </div>
                `;

                ordersListEl.appendChild(card);
            });

            // Delegação para abrir/fechar detalhes
            ordersListEl.addEventListener('click', function(e){
                const btn = e.target.closest('button[data-id]');
                if (!btn) return;
                const id = btn.getAttribute('data-id');
                const details = document.getElementById('details-' + id);
                if (!details) return;
                details.style.display = details.style.display === 'block' ? 'none' : 'block';
            });
        });
    </script>
</body>
</html>
