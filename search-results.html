<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados de Busca - Loja do Flamengo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .search-results-container { max-width: 1200px; margin: 30px auto; padding: 20px; }
        .search-header { margin-bottom: 30px; }
        .search-header h1 { color: #e30613; margin-bottom: 10px; }
        .search-filters { display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; }
        .filter-btn { background: #222; color: #fff; border: 1px solid #333; padding: 8px 16px; border-radius: 20px; cursor: pointer; transition: all 0.3s; }
        .filter-btn.active { background: #e30613; border-color: #e30613; }
        .filter-btn:hover { border-color: #e30613; }
        .results-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px; }
        .result-card { background: #111; border: 1px solid #333; border-radius: 8px; overflow: hidden; cursor: pointer; transition: all 0.3s; }
        .result-card:hover { border-color: #e30613; }
        .result-img { width: 100%; height: 200px; object-fit: cover; }
        .result-info { padding: 12px; }
        .result-name { color: #fff; font-weight: 600; margin-bottom: 6px; font-size: 0.9rem; }
        .result-price { color: #e30613; font-weight: 700; }
        .no-results { text-align: center; color: #bbb; padding: 60px 20px; }
        .back-link { color: #e30613; text-decoration: none; display: inline-block; margin-bottom: 20px; }
        .back-link:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <header class="meli-header">
        <div class="header-top-bar">
            <div class="logo-container">
                <a href="index.html"><img src="imagens/logo1.jpg" alt="Flamengo Logo" class="meli-logo"></a>
            </div>
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Buscar camisas, acessórios e mais do Flamengo...">
                <button class="search-button"><i class="fas fa-search"></i></button>
            </div>
            <div class="header-right-items">
                <div class="header-icons">
                    <i class="fas fa-map-marker-alt"></i>
                    <span class="location-text">CEP</span>
                </div>
                <div class="cart-icon-container">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cartBadge" class="cart-badge" style="display:none;">0</span>
                </div>
            </div>
        </div>
        <nav class="header-bottom-nav">
            <div class="categories-container"><i class="fas fa-bars"></i><span>Camisas</span></div>
            <div class="main-nav">
                <a href="camisas-oficiais.html" class="nav-link">Camisas Oficiais</a>
                <a href="acessorios.html" class="nav-link">Acessórios</a>
                <a href="infantil.html" class="nav-link">Infantil</a>
                <a href="promocoes.html" class="nav-link">Promoções</a>
            </div>
            <div class="account-nav">
                <a href="account.html" class="nav-link">Minha conta</a>
                <a href="orders.html" class="nav-link">Pedidos</a>
                <a href="#" class="nav-link">Ajuda</a>
            </div>
        </nav>
    </header>

    <main class="search-results-container">
        <a href="index.html" class="back-link"><i class="fas fa-arrow-left"></i> Voltar</a>
        
        <div class="search-header">
            <h1>Resultados para: <span id="searchQuery"></span></h1>
            <p id="resultCount" style="color: #bbb;"></p>
        </div>

        <div class="search-filters" id="filterButtons"></div>
        <div class="results-grid" id="resultsGrid"></div>
    </main>

    <!-- Modal de Detalhe do Produto -->
    <div id="productModal" class="modal-overlay" style="display:none;">
        <div class="modal-content">
            <button class="modal-close" onclick="closeProductModal()">&times;</button>
            <div class="modal-body">
                <div class="modal-image"><img id="modalProductImage" src="" alt="Produto" /></div>
                <div class="modal-info">
                    <h2 id="modalProductTitle">Produto</h2>
                    <p id="modalProductDescription" class="product-desc"></p>
                    <div class="product-price-section">
                        <span class="product-label">Preço:</span>
                        <span id="modalProductPrice" class="product-price">R$ 0,00</span>
                    </div>
                    <div class="product-sizes" id="modalProductSizes"></div>
                    <div class="product-colors" id="modalProductColors"></div>
                    <div class="modal-actions">
                        <input type="number" id="modalProductQty" min="1" value="1" class="qty-input" placeholder="Qtd" />
                        <button class="btn-add-cart" onclick="addToCart()">Adicionar ao carrinho</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="footer-bottom">
            <p>© <span id="year"></span> Clube de Regatas do Flamengo — Loja Oficial. Todos os direitos reservados.</p>
        </div>
    </footer>

    <script src="cart.js"></script>
        <script src="imgFallback.js"></script>
    <script src="search.js"></script>
    <script>
        document.getElementById('year').textContent = new Date().getFullYear();

        // Base de produtos completa
        const allProducts = [
            // Camisas
            { name: 'Camisa Oficial 2025', price: 199.90, image: 'imagens/camisaFla.jpg', category: 'camisas', sizes: ['P', 'M', 'G', 'GG'], colors: ['Vermelho e Preto'] },
            { name: 'Camisa Retrô 1981', price: 149.90, image: 'imagens/CamisaRetro.jpg', category: 'camisas', sizes: ['P', 'M', 'G', 'GG'], colors: ['Vermelho e Preto'] },
            { name: 'Camisa Edição Especial', price: 249.90, image: 'imagens/camisaFla.jpg', category: 'camisas', sizes: ['P', 'M', 'G', 'GG'], colors: ['Vermelho', 'Preto'] },
            { name: 'Camisa Infantil', price: 129.90, image: 'imagens/camisaFla.jpg', category: 'infantil', sizes: ['4', '6', '8', '10', '12'], colors: ['Vermelho e Preto'] },
            // Acessórios
            { name: 'Boné Oficial Flamengo', price: 79.90, image: 'imagens/BoneFla.jpg', category: 'acessorios', sizes: ['Único'], colors: ['Vermelho', 'Preto'] },
            { name: 'Agasalho Rubro-Negro', price: 249.90, image: 'imagens/AgasalhoFla.png', category: 'acessorios', sizes: ['P', 'M', 'G', 'GG'], colors: ['Vermelho e Preto'] },
            { name: 'Chaveiro Escudo Flamengo', price: 29.90, image: 'imagens/chaveiroFla.jpg', category: 'acessorios', sizes: ['Único'], colors: ['Vermelho e Preto'] },
            // Promoções
            { name: 'Kit 3 Camisas', price: 449.90, image: 'imagens/camisaFla.jpg', category: 'promocoes', sizes: ['P', 'M', 'G', 'GG'], colors: ['Variadas'] },
            { name: 'Pack Torcedor', price: 299.90, image: 'imagens/BoneFla.jpg', category: 'promocoes', sizes: ['Único'], colors: ['Vermelho e Preto'] }
        ];

        let filteredProducts = [];
        let currentFilter = 'todos';
        let currentProduct = {};

        function initSearch() {
            const params = new URLSearchParams(window.location.search);
            const query = params.get('q')?.toLowerCase() || '';
            
            document.getElementById('searchQuery').textContent = query;
            document.querySelector('.search-input').value = query;

            // Filtrar produtos
            filteredProducts = allProducts.filter(p => 
                p.name.toLowerCase().includes(query) || 
                p.category.toLowerCase().includes(query)
            );

            document.getElementById('resultCount').textContent = 
                filteredProducts.length > 0 
                    ? `${filteredProducts.length} produto(s) encontrado(s)` 
                    : 'Nenhum produto encontrado';

            renderResults();
            renderFilters();
        }

        function renderFilters() {
            const filterContainer = document.getElementById('filterButtons');
            const categories = ['todos', ...new Set(filteredProducts.map(p => p.category))];
            
            filterContainer.innerHTML = categories.map(cat => `
                <button class="filter-btn ${currentFilter === cat ? 'active' : ''}" onclick="filterByCategory('${cat}')">
                    ${cat === 'camisas' ? 'Camisas' : cat === 'acessorios' ? 'Acessórios' : cat === 'infantil' ? 'Infantil' : cat === 'promocoes' ? 'Promoções' : 'Todos'}
                </button>
            `).join('');
        }

        function filterByCategory(category) {
            currentFilter = category;
            renderResults();
            renderFilters();
        }

        function renderResults() {
            const grid = document.getElementById('resultsGrid');
            const params = new URLSearchParams(window.location.search);
            const query = params.get('q')?.toLowerCase() || '';

            let results = allProducts.filter(p => 
                (p.name.toLowerCase().includes(query) || p.category.toLowerCase().includes(query)) &&
                (currentFilter === 'todos' || p.category === currentFilter)
            );

            if (results.length === 0) {
                grid.innerHTML = '<div class="no-results" style="grid-column: 1/-1;">Nenhum produto encontrado para sua busca.</div>';
                return;
            }

            grid.innerHTML = results.map(product => `
                <div class="result-card" onclick="openProductModal('${product.name}', 'Produto oficial do Flamengo', '${product.image}', ${product.price}, ['${product.sizes.join("','")}'], ['${product.colors.join("','")}'])">
                    <img src="${product.image}" alt="${product.name}" class="result-img">
                    <div class="result-info">
                        <p class="result-name">${product.name}</p>
                        <p class="result-price">R$ ${product.price.toFixed(2).replace('.', ',')}</p>
                    </div>
                </div>
            `).join('');
        }

        function openProductModal(title, desc, image, price, sizes, colors) {
            currentProduct = { name: title, price, sizes, colors };
            document.getElementById('modalProductImage').src = image;
            document.getElementById('modalProductTitle').textContent = title;
            document.getElementById('modalProductDescription').textContent = desc;
            document.getElementById('modalProductPrice').textContent = `R$ ${price.toFixed(2).replace('.', ',')}`;
            document.getElementById('modalProductQty').value = '1';

            const sizesEl = document.getElementById('modalProductSizes');
            sizesEl.innerHTML = `<strong>Tamanho:</strong> <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;">${sizes.map(s => `<button onclick="selectSize('${s}')" style="padding:8px 12px;border:1px solid #e30613;background:transparent;color:#fff;cursor:pointer;border-radius:4px;">${s}</button>`).join('')}</div>`;

            const colorsEl = document.getElementById('modalProductColors');
            colorsEl.innerHTML = `<strong>Cor:</strong> <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap;">${colors.map(c => `<button onclick="selectColor('${c}')" style="padding:8px 12px;border:1px solid #e30613;background:transparent;color:#fff;cursor:pointer;border-radius:4px;">${c}</button>`).join('')}</div>`;

            document.getElementById('productModal').style.display = 'flex';
        }

        function closeProductModal() {
            document.getElementById('productModal').style.display = 'none';
        }

        function selectSize(size) {
            currentProduct.size = size;
        }

        function selectColor(color) {
            currentProduct.color = color;
        }

        function addToCart() {
            if (!currentProduct.size || !currentProduct.color) {
                alert('Selecione tamanho e cor');
                return;
            }
            const qty = parseInt(document.getElementById('modalProductQty').value) || 1;
            cart.addItem({ ...currentProduct, quantity: qty });
            alert('Adicionado ao carrinho!');
            closeProductModal();
        }

        document.querySelector('.cart-icon-container')?.addEventListener('click', () => {
            window.location.href = 'checkout.html';
        });

        // Inicializar
        initSearch();
    </script>
</body>
</html>
